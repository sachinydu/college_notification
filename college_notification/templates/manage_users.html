{% extends 'base.html' %}

{% block content %}
<div style="padding: 2rem;">
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
    <h1 style="margin: 0;">User Management</h1>
    <a href="{{ url_for('add_user') }}" class="btn btn-primary">
      <i class="fas fa-plus"></i> Add New User
    </a>
  </div>

  <div class="card">
    <table style="width: 100%; border-collapse: collapse;">
      <thead>
        <tr style="background: #f5f5f5;">
          <th style="padding: 1rem; text-align: left; border-bottom: 2px solid #ddd;">Username</th>
          <th style="padding: 1rem; text-align: left; border-bottom: 2px solid #ddd;">Email</th>
          <th style="padding: 1rem; text-align: left; border-bottom: 2px solid #ddd;">Role</th>
          <th style="padding: 1rem; text-align: left; border-bottom: 2px solid #ddd;">Created</th>
          <th style="padding: 1rem; text-align: center; border-bottom: 2px solid #ddd;">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for user in users %}
        <tr style="border-bottom: 1px solid #eee;">
          <td style="padding: 1rem;">
            <strong>{{ user.username }}</strong>
          </td>
          <td style="padding: 1rem;">{{ user.email or '-' }}</td>
          <td style="padding: 1rem;">
            <span style="background: 
              {% if user.role == 'admin' %}rgba(239, 68, 68, 0.1); color: #dc2626
              {% elif user.role == 'faculty' %}rgba(59, 130, 246, 0.1); color: #2563eb
              {% else %}rgba(34, 197, 94, 0.1); color: #16a34a
              {% endif %};
              padding: 0.25rem 0.75rem; border-radius: 99px; font-size: 0.875rem; font-weight: 600;">
              {{ user.role|upper }}
            </span>
          </td>
          <td style="padding: 1rem; font-size: 0.875rem; color: #666;">
            {{ user.created_at[:10] if user.created_at else '-' }}
          </td>
          <td style="padding: 1rem; text-align: center;">
            <form method="POST" action="{{ url_for('reset_user_password', id=user.id) }}" style="display: inline;">
              <button type="submit" class="btn btn-sm btn-secondary" style="margin-right: 0.5rem;" 
                onclick="return confirm('Reset password for {{ user.username }}?')">
                <i class="fas fa-redo"></i> Reset
              </button>
            </form>
            {% if user.id != session.get('user_id') %}
            <form method="POST" action="{{ url_for('delete_user', id=user.id) }}" style="display: inline;">
              <button type="submit" class="btn btn-sm btn-danger" 
                onclick="return confirm('Delete user {{ user.username }}? This cannot be undone.')">
                <i class="fas fa-trash"></i> Delete
              </button>
            </form>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% if not users %}
    <div style="padding: 2rem; text-align: center; color: #999;">
      <p>No users found</p>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}
